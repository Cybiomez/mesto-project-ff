(()=>{"use strict";function t(t,e,n){var o=document.querySelector("#card-template").content.querySelector(".places__item").cloneNode(!0),c=o.querySelector(".card__title"),r=o.querySelector(".card__image"),a=o.querySelector(".card__like-button_counter"),i=o.querySelector(".card__delete-button"),u=o.querySelector(".card__like-button");return c.textContent=t.name,r.src=t.link,r.alt=t.name,a.textContent=t.likes.length,t.owner._id!==e._id&&i.classList.add("card__delete-button_unavailable"),t.likes.forEach((function(t){t._id.includes("".concat(e._id))&&u.classList.add("card__like-button_is-active")})),i.addEventListener("click",(function(){return n.deleteCard(o,t._id)})),u.addEventListener("click",(function(){return n.likeCard(u,a,t)})),r.addEventListener("click",(function(){return n.handleImageClick(r)})),o}function e(t){t.classList.add("popup_is-opened"),document.addEventListener("keyup",o)}function n(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keyup",o)}function o(t){"Escape"===t.key&&n(document.querySelector(".popup_is-opened"))}function c(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?e.classList.remove(n.inactiveButtonClass):e.classList.add(n.inactiveButtonClass)}function r(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);n.forEach((function(n){var o=t.querySelector(".".concat(n.id,"-error"));n.classList.remove(e.inputErrorClass),o.classList.remove(e.errorClass),o.textContent=""})),o.classList.add(e.inactiveButtonClass)}var a,i="https://nomoreparties.co/v1/wff-cohort-25",u="eff53e97-693a-49d3-ba0b-f139517f1f78",s=fetch("".concat(i,"/users/me"),{method:"GET",headers:{authorization:u}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){console.log(console.log("Ошибка: ".concat(t)))})),l=fetch("".concat(i,"/cards"),{method:"GET",headers:{authorization:u}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){console.log(console.log("Ошибка: ".concat(t)))})),d=document.querySelector(".profile__image"),p=document.querySelector(".profile__title"),f=document.querySelector(".profile__description"),_=document.querySelector(".places__list"),m=Array.from(document.querySelectorAll(".popup")),y=document.querySelector(".popup_type_new-image"),h=document.querySelector(".popup_type_edit"),v=document.querySelector(".popup_type_new-card"),S=document.querySelector(".popup_type_image"),g=document.forms["new-image"],C=document.forms["edit-profile"],k=document.forms["new-place"],q=document.querySelector(".popup__input_type_url-profile-image"),b=document.querySelector(".popup__input_type_name"),L=document.querySelector(".popup__input_type_description"),E=document.querySelector(".popup__input_type_card-name"),j=document.querySelector(".popup__input_type_url-card"),x=document.querySelector(".profile__edit-image-button"),P=document.querySelector(".profile__edit-button"),T=document.querySelector(".profile__add-button"),A=document.querySelector(".popup__caption"),z=document.querySelector(".popup__image"),w={deleteCard:function(t,e){fetch("".concat(i,"/cards/").concat(e),{method:"DELETE",headers:{authorization:u}}).then(t.remove())},likeCard:function(t,e,n){t.classList.contains("card__like-button_is-active")?fetch("".concat(i,"/cards/likes/").concat(n._id),{method:"DELETE",headers:{authorization:u}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(n){t.classList.toggle("card__like-button_is-active"),e.textContent=n.likes.length})).catch((function(t){console.log(console.log("Ошибка: ".concat(t)))})):fetch("".concat(i,"/cards/likes/").concat(n._id),{method:"PUT",headers:{authorization:u}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(n){t.classList.toggle("card__like-button_is-active"),e.textContent=n.likes.length})).catch((function(t){console.log(console.log("Ошибка: ".concat(t)))}))},handleImageClick:function(t){A.textContent=t.alt,z.src=t.src,z.alt=t.alt,e(S)}},B={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function D(t,e){var n=e.querySelector(".button");t?(a=n.textContent,n.textContent="Сохранение..."):t||(n.textContent=a)}x.addEventListener("click",(function(){e(y)})),P.addEventListener("click",(function(){b.value=p.textContent,L.value=f.textContent,r(h,B),e(h)})),T.addEventListener("click",(function(){e(v)})),m.forEach((function(t){t.addEventListener("mousedown",(function(e){(e.target.classList.contains("popup_is-opened")||e.target.classList.contains("popup__close"))&&n(t)}))})),g.addEventListener("submit",(function(t){t.preventDefault(),D(!0,g),function(t,e){return fetch("".concat(i,"/users/me/avatar "),{method:"PATCH",headers:{authorization:u,"Content-Type":"application/json"},body:JSON.stringify({avatar:e.value})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(e){t.style="background-image: url(".concat(e.avatar,")")})).catch((function(t){console.log(console.log("Ошибка: ".concat(t)))}))}(d,q).finally((function(){D(!1,g),n(y),g.reset(),r(y,B)}))})),C.addEventListener("submit",(function(t){t.preventDefault(),D(!0,C),function(t,e,n,o){return fetch("".concat(i,"/users/me"),{method:"PATCH",headers:{authorization:u,"Content-Type":"application/json"},body:JSON.stringify({name:n.value,about:o.value})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(n){t.textContent=n.name,e.textContent=n.about})).catch((function(t){console.log(console.log("Ошибка: ".concat(t)))}))}(p,f,b,L).finally((function(){D(!1,C),n(h),r(h,B)}))})),k.addEventListener("submit",(function(e){e.preventDefault(),D(!0,k),function(t,e,n,o,c){var r=fetch("".concat(i,"/cards"),{method:"POST",headers:{authorization:u,"Content-Type":"application/json"},body:JSON.stringify({name:t.value,link:e.value})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){console.log(console.log("Ошибка: ".concat(t)))}));return Promise.all([s,r]).then((function(t){n.prepend(o(t[1],t[0],c))}))}(E,j,_,t,w).finally((function(){D(!1,k),n(v),k.reset(),r(h,B)}))})),function(t,e,n){s.then((function(o){t.style="background-image: url(".concat(o.avatar,")"),e.textContent=o.name,n.textContent=o.about}))}(d,p,f),function(t,e,n){Promise.all([s,l]).then((function(o){o[1].forEach((function(c){t.append(e(c,o[0],n))}))}))}(_,t,w),function(t){Array.from(document.querySelectorAll(t.formSelector)).forEach((function(e){e.addEventListener("submit",(function(t){t.preventDefault()})),function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);c(n,o,e),n.forEach((function(r){r.addEventListener("input",(function(){(function(t,e,n){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?function(t,e,n){var o=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}(t,e,n):function(t,e,n,o){var c=t.querySelector(".".concat(e.id,"-error"));e.classList.add(n.inputErrorClass),c.textContent=o,console.log(o),c.classList.add(n.errorClass)}(t,e,n,e.validationMessage)})(t,r,e),c(n,o,e)}))}))}(e,t)}))}(B)})();